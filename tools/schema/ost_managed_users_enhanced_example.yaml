# Enhanced Schema File
# Generated by PocketBase Schema Extractor v2.0
# Created: 2025-01-08T15:30:00Z
# Updated: 2025-01-08T15:30:00Z
# Source: PocketBase collection 'ost_managed_users'
# Description: Manages user accounts within organizations with role-based access control

table: ost_managed_users
description: "Stores managed user accounts for multi-tenant organizations with role assignments and organizational unit associations"

fields:
  - name: id
    type: text
    description: "Unique identifier for the managed user record"
    primaryKey: true

  - name: name
    type: text
    description: "Full display name of the user"
    required: true
    validation:
      min: 1
      max: 100

  - name: email
    type: text
    description: "User's email address for authentication and communication"
    required: true
    validation:
      pattern: "^[\\w\\.-]+@[\\w\\.-]+\\.[a-zA-Z]{2,}$"

  - name: password
    type: text
    description: "Encrypted password for user authentication"
    required: true
    validation:
      min: 8

  - name: isActive
    type: integer
    description: "Flag indicating if the user account is active (1) or disabled (0)"
    required: true
    default: 1

  - name: organization
    type: text
    description: "Reference to the organization this user belongs to"
    relationship:
      type: "single"
      collectionId: "ost_organizations"
      maxSelect: 1
      minSelect: 1
      cascadeDelete: false

  - name: role
    type: text
    description: "Primary role assignment for this user within the organization"
    relationship:
      type: "single"
      collectionId: "rbac_organization_roles"
      maxSelect: 1
      minSelect: 0
      cascadeDelete: false

  - name: organizationUnits
    type: text
    description: "Organizational units this user has access to"
    relationship:
      type: "multiple"
      collectionId: "ost_units"
      maxSelect: 10
      minSelect: 0
      cascadeDelete: false

  - name: organizationGroups
    type: text
    description: "Groups within the organization this user belongs to"
    relationship:
      type: "multiple"
      collectionId: "rbac_organization_groups"
      maxSelect: 5
      minSelect: 0
      cascadeDelete: false

  - name: organizationRoles
    type: text
    description: "Additional roles assigned to this user"
    relationship:
      type: "multiple"
      collectionId: "rbac_organization_roles"
      maxSelect: 3
      minSelect: 0
      cascadeDelete: false

  - name: emailVisibility
    type: integer
    description: "Controls email visibility: 0=private, 1=public within org, 2=global"
    required: true
    default: 0
    options:
      values: [0, 1, 2]
      maxSelect: 1

  - name: verified
    type: integer
    description: "Email verification status (1=verified, 0=pending verification)"
    default: 0

  - name: tokenKey
    type: text
    description: "Authentication token key for API access"
    required: true

  - name: userName
    type: text
    description: "Unique username for login (alternative to email)"
    validation:
      min: 3
      max: 30
      pattern: "^[a-zA-Z0-9._-]+$"

  # Audit trail fields
  - name: createdAt
    type: text
    description: "Timestamp when the record was created"

  - name: createdBy
    type: text
    description: "User who created this record"
    relationship:
      type: "single"
      collectionId: "_pb_users_auth_"
      maxSelect: 1
      minSelect: 0
      cascadeDelete: false

  - name: updatedAt
    type: text
    description: "Timestamp when the record was last updated"

  - name: updatedBy
    type: text
    description: "User who last updated this record"
    relationship:
      type: "single"
      collectionId: "_pb_users_auth_"
      maxSelect: 1
      minSelect: 0
      cascadeDelete: false

  - name: deletedAt
    type: text
    description: "Soft delete timestamp (null if not deleted)"

  # Sync metadata fields
  - name: lastSyncedAt
    type: text
    description: "Last successful synchronization timestamp with remote server"

  - name: syncVersion
    type: integer
    description: "Version number for optimistic concurrency control during sync"
    default: 0

  - name: isDirty
    type: integer
    description: "Flag indicating if record has unsynchronized changes (1=dirty, 0=clean)"
    default: 1

  - name: isDeleted
    type: integer
    description: "Soft delete flag for sync purposes (1=deleted, 0=active)"
    default: 0

# Suggested indexes for performance optimization
indexes:
  - fields: [organization]
    name: idx_managed_users_organization
  - fields: [email]
    name: idx_managed_users_email
    unique: true
  - fields: [isActive, isDeleted]
    name: idx_managed_users_active_status
  - fields: [isDirty]
    name: idx_managed_users_sync_dirty

# Schema metadata
metadata:
  version: "2.0"
  author: "PocketBase Schema Extractor"
  lastExtracted: "2025-01-08T15:30:00Z"
  totalFields: 20
  relationshipFields: 5
  requiredFields: 7
  notes:
    - "Multi-tenant user management with RBAC support"
    - "Supports both email and username authentication"
    - "Includes comprehensive audit trail and sync metadata"
    - "Relationships to organization structure and role system"
